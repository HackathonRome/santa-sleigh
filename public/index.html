<!DOCTYPE html>
<html lang="en">
<head>
  <title>Santa Sleigh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="stylesheet" type="text/css" href="components/bootstrap/dist/css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="components/typeahead.js-bootstrap.css/typeahead.js-bootstrap.css">
  <style>
    .conversation {
      font-size: 18px;
      margin: 10px;
    }
    .final {
      font-color: #000;
    }
    .interim {
      font-color: #f00;
    }
    #join{
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body data-agent="">

<div class="container">
  <div class="row">
    <div class="col-md-12" style="text-align:center">
      <h1>SANTA SLEIGH! HO HO HO!</h1>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12">
      <!-- names & rooms-->
      <ul id="rooms" class="list-group"></ul>
      <p id="createRoom"><button id="showCreateRoom" class="btn btn-warning btn-lg">Create room</button></p>
      <form class="form-inline" id="createRoomForm"><input type="text" class="form-control input-lg"  placeholder="Room name" id="createRoomName"><button id="createRoomBtn" class="btn btn-success btn-lg">Create room</button></form>
      <ul id="people" class="list-group"></ul>
    </div>
    <div class="col-md-12">
      <!-- the main chat screen -->
      <div class="alert alert-danger" id="errors"></div>
      <div id="login">
        <form class="form-inline">
          <div class="form-group">
            <input type="text" class="form-control input-lg" id="name" placeholder="username">
          </div>
          <input type="button" name="join" id="join" value="Play!" class="btn btn-primary btn-lg">
        </form>
      </div>

      <div id="chat">
        <form id="2" class="form-inline">
          <div class="input-group">
            <span class="input-group-addon">Whisper? <input type="checkbox" id="whisper"></span>
            <input type="text" class="form-control input-lg" placeholder="Your message" id="msg">
          </div>
          <input type="button" name="send" id="send" value="Send" class="btn btn-success btn-lg">
          <input type="button" name="start_button" id="start_button" value="Record" onclick="startButton(event)" class="btn btn-info btn-lg">
          <input type="button" name="leave" id="leave" value="Leave Room" class="btn btn-warning btn-lg">
        </form>
      </div>
       <div class="conversation">
        <ul id="msgs" class="list-unstyled"></ul>
      </div>
      <div id="container-mobile">
        
      </div>
    </div>
  </div>
</div>
<script src="components/jquery/jquery.js"></script>
<script src="components/bootstrap/dist/js/bootstrap.js"></script>
<script src="components/typeahead.js/dist/typeahead.js"></script>
<script src="/socket.io/socket.io.js"></script>  
<script src="js/client.js"></script>
<script src="js/kinetic-v4.7.4.min.js"></script>
<script type="text/javascript">
  function getTheCode(){
    timestamp = new Date().getTime();
    code = timestamp+"";
    return code.substring(8,13);
  }
  $(document).ready(function(){
    $('input#name').hide();
    $('input#join').removeAttr('disabled');
    var isMobileDevice = navigator.userAgent.match(/iPad|iPhone|iPod|Android/i) != null
    if(isMobileDevice){
      $('body').data("agent","mobile");
      $('input#name').val("mobile"+getTheCode());
    }else{
      $('body').data("agent","desktop");
      $('input#name').val("desktop"+getTheCode());
      $('input#createRoomName').val(getTheCode());
      $('#container-mobile').hide();
    }
  });
</script>
    <script defer="defer">
      var socket = io.connect("192.168.43.89:3000");
      var stage = new Kinetic.Stage({
        container: 'container-mobile',
        width: screen.width,
        height: screen.height
      });
      var startX = 0;
      var startY = 0;

      var tween;
      var layer = new Kinetic.Layer();
      var rectX = stage.getWidth() / 4 - 50;
      var rectY = stage.getHeight() / 4 - 25;

      var xOne = stage.getWidth()/4 - 50;
      var yOne = stage.getHeight()/3 - 25;

      var xTwo = stage.getWidth()/4*3-50;
      var yTwo = (stage.getHeight()/3)*2 -25;

      var xThree = (stage.getWidth()/4)*3 - 50;
      var yThree = (stage.getHeight()/3)-25;

      var xFour = stage.getWidth()/4 - 50;
      var yFour = stage.getHeight()/3*2 - 25;

      var posObj = {
        'one': {'x':xOne, 'y':yOne},
        'two': {'x':xTwo, 'y':yTwo},
        'three': {'x':xThree, 'y':yThree},
        'four': {'x':xFour, 'y':yFour}
      };

      var box = new Kinetic.Rect({
        x: stage.getWidth()/4 - 50,
        y: stage.getHeight()/3 - 25,
        width: 100,
        height: 50,
        fill: '#00D2FF',
        stroke: 'black',
        name:'one',
        strokeWidth: 4,
        draggable: true
      });

      var box2 = new Kinetic.Rect({
        x: stage.getWidth()/4*3-50 ,
        y: (stage.getHeight()/3)*2 -25,
        width: 100,
        height: 50,
        name:'two',
        fill: '#000000',
        stroke: 'black',
        strokeWidth: 4,
        draggable: true
      });

      var box3 = new Kinetic.Rect({
        x: (stage.getWidth()/4)*3 - 50,
        y: (stage.getHeight()/3)-25,
        width: 100,
        height: 50,
        name:'three',
        fill: '#FF5050',
        stroke: 'black',
        strokeWidth: 4,
        draggable: true
      });

      var box4 = new Kinetic.Rect({
        x: stage.getWidth()/4 - 50,
        y: stage.getHeight()/3*2 - 25,
        width: 100,
        height: 50,
        name:'four',
        fill: '#33CC33',
        stroke: 'black',
        strokeWidth: 4,
        draggable: true
      });

      createRect(box);
      createRect(box2);
      createRect(box3);
      createRect(box4);


      stage.add(layer);

      function createRect(itemToClone){
        var na = itemToClone.getName().toString();
        var xy = posObj[na];
        var newItem =new Kinetic.Rect({
          x: xy['x'],
          y: xy['y'],
          width: 100,
          height: 50,
          name:na,
          id:itemToClone.getName(),
          fill: itemToClone.getFill(),
          stroke: 'black',
          strokeWidth: 4,
          draggable: true
        });

        newItem.on('dragstart', function(){
          startX = this.getX();
          startY = this.getY();
          createRect(this);
        });
        newItem.on('dragend', function() {
          var that = this;
          var dx = (that.getX() - startX) < 0 ? -screen.width*2 : screen.width*2;
          startEase(that, dx);
          var direction = (dx > 0) ? 'right' : 'left';
          var pack = {
            color: that.getFill(),
            dir: direction
          }
          socket.emit("send",  JSON.stringify(pack));
        });
        layer.add(newItem);
      }

      function getStartPoint(name){
        

      }

      function startEase(item, dxparam){
        dx = dxparam;
        tween = new Kinetic.Tween({
          node: item, 
          duration: 1,
          opacity:0,
          x: dx,
          y: -1000,
          scaleX: 0.5,
          onFinish: function() {
            item.remove();
          }
        });
        tween.play();
      }

      function calculateAngle(xt, xo, yt, yo,x){
        var y = ((yt^2-yo)/(xt^2-xo))*(x-xo)+yo;
        return y;
      }


    </script>
</body>
</html>
